name: Feature

on:
  push:
    branches: [ 'feature/**' ]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Up services
      run: docker compose up -d

    - name: Run tests
      run: docker run --network=midarr-server_default \
        -e DB_USERNAME='my_user' \
        -e DB_PASSWORD='my_password' \
        -e DB_DATABASE='my_database' \
        -e DB_HOSTNAME='postgresql' \
        -e TEST_DB_HOSTNAME='test-postgresql' \
        midarr-server_midarr:latest mix test